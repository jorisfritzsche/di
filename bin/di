#!/usr/bin/php
<?php

/*
 * This file is part of the Di package.
 *
 * (c) Joris Fritzsche <joris.fritzsche@outlook.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

declare(strict_types = 1);

error_reporting(E_ALL);
ini_set('display_errors', '1');

try {
    /**
     * Custom autoloader for the DI CLI. N.B. only works for native PHP and DI classes.
     *
     * @param string $className
     */
    function diCliAutoload(string $className) {
        $src = dirname(
                dirname(__FILE__)
            )
            . DIRECTORY_SEPARATOR
            . 'src'
            . DIRECTORY_SEPARATOR
            . 'Di'
            . DIRECTORY_SEPARATOR;

        $className = str_replace(['\\Di', 'Di'], '', $className);
        $file = str_replace('\\', DIRECTORY_SEPARATOR, $className) . '.php';

        /** @noinspection PhpIncludeInspection */
        require_once($src . $file);
    }

    /** Register the autoloader. */
    spl_autoload_register('diCliAutoload');

    /**
     * Instantiate the CLI and execute the operation.
     */
    $cli = new \Di\Cli();
    $cli->execute();
    $cli->output("Operation completed.", true);
} catch (\Exception $e) {
    echo "\033[31m" . $e->getMessage() . PHP_EOL . PHP_EOL;
    echo "\e[34mStack trace:" . $e->getTraceAsString() . "\033[0m" . PHP_EOL;
}

